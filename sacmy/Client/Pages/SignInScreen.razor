@page "/"
@using System.Text.Json
@using System.Net
@using System.Text
@using System.Web
@using sacmy.Services
@using sacmy.Shared.Core
@using sacmy.Shared.ViewModels.UserViewModel
@inject HttpClient _httpClient
@inject AuthService _authService
@inject UserGlobalClass _userGlobalClass
@inject NavigationManager navigationManager;
@layout NoAppbarLayout;

<style>
    body {
        background-color: #f8f9fa;
        margin: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        width: 100vw;
    }

    .login-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width: 100%;
        height:100%;
        max-width: 400px;
        padding: 40px;
        
        border-radius: 10px;
        overflow: hidden;
        background-color: #f8f9fa;
    }

    .login-logo {
        margin-bottom: 20px;
    }

        .login-logo img {
            max-width: 100px;
            height: auto;
        }

    .login-title {
        font-size: 20px;
        margin-bottom: 20px;
        text-align: center;
    }

    .form-group {
        margin-bottom: 20px;
        width: 100%;
    }

    .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
    }

    .form-group input {
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
    }

    .login-button {
        width: 100%;
        padding: 10px;
        background-color: #3f51b5;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
    }

    .login-button:hover {
        background-color: #303f9f;
    }

</style>

<div class="login-container">
    <div class="login-logo">
        <img src="images/website_logo.png" alt="SAFIN AHMED COMPANY Logo">
    </div>
    <div class="login-title">
        SAFIN AHMED COMPANY
    </div>
    <MudForm @ref="_form" @bind-IsValid="_isFormValid">
        <div class="form-group">
            <label for="phoneNumber">رقم الهاتف</label>
            <MudTextField T="string" @bind-Value="phoneNumber" Variant="Variant.Outlined" Margin="Margin.Dense" Required="true" RequiredError="Please Enter Phone Number" />
        </div>
        <div class="form-group">
            <label for="password">ألباسورد</label>
            <MudTextField T="string" @bind-Value="password" InputType="InputType.Password" Variant="Variant.Outlined" Margin="Margin.Dense" Required="true" RequiredError="Please Enter Password" />
        </div>
        <MudButton Variant="Variant.Filled" OnClick="SignIn" Color="Color.Primary" FullWidth="true" Disabled="@(!_isFormValid || _loading)">
            @if (_loading)
            {
                <MudProgressCircular Class="ms-n1" Size="MudBlazor.Size.Small" Indeterminate="true" />
                <span class="ms-2">Loading</span>
            }
            else
            {
                <span>تسجيل الدخول</span>
            }
        </MudButton>
    </MudForm>
</div>

@code {
    private MudForm _form;
    private bool _loading = false;
    private bool _isFormValid = false;
    private string phoneNumber;
    private string password;

    private async Task SignIn()
    {
        if (_isFormValid)
        {
            _loading = true;

            var user = await _authService.SignInAsync(phoneNumber, password);

            if (_userGlobalClass.User != null)
            {
                // Navigate to home screen or wherever you need
                navigationManager.NavigateTo("/HomeScreen");
            }
            else
            {
                // Handle login failure
                // Display an error message or notification
            }

            _loading = false;
        }
    }
}












